# ScanPro QR - æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ
## MVP é˜¶æ®µæŠ€æœ¯å®ç°ç»†èŠ‚

**ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026å¹´1æœˆ29æ—¥  
**ç›®æ ‡å¹³å°**ï¼šAndroid + iOS

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€æ¶æ„æ¦‚è§ˆ](#ä¸€æ¶æ„æ¦‚è§ˆ)
- [äºŒã€æŠ€æœ¯æ ˆé€‰å‹](#äºŒæŠ€æœ¯æ ˆé€‰å‹)
- [ä¸‰ã€é¡¹ç›®ç»“æ„](#ä¸‰é¡¹ç›®ç»“æ„)
- [å››ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡](#å››æ ¸å¿ƒæ¨¡å—è®¾è®¡)
- [äº”ã€æ•°æ®åº“è®¾è®¡](#äº”æ•°æ®åº“è®¾è®¡)
- [å…­ã€API è®¾è®¡ï¼ˆé¢„ç•™ï¼‰](#å…­api-è®¾è®¡é¢„ç•™)
- [ä¸ƒã€æ€§èƒ½ä¼˜åŒ–](#ä¸ƒæ€§èƒ½ä¼˜åŒ–)
- [å…«ã€å®‰å…¨è€ƒè™‘](#å…«å®‰å…¨è€ƒè™‘)
- [ä¹ã€æµ‹è¯•ç­–ç•¥](#ä¹æµ‹è¯•ç­–ç•¥)
- [åã€éƒ¨ç½²æ–¹æ¡ˆ](#åéƒ¨ç½²æ–¹æ¡ˆ)

---

## ä¸€ã€æ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ‰«æé¡µé¢ â”‚  â”‚ ç”Ÿæˆé¡µé¢ â”‚  â”‚ å†å²é¡µ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚æ‰«ææœåŠ¡  â”‚  â”‚ç”ŸæˆæœåŠ¡  â”‚  â”‚æ•°æ®æœåŠ¡â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®è®¿é—®å±‚ (Data Layer)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SQLite   â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ  â”‚  â”‚ ç³»ç»ŸAPIâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åŸç”Ÿå¹³å°å±‚ (Platform Layer)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Android  â”‚  â”‚   iOS    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„åŸåˆ™

1. **åˆ†å±‚æ¸…æ™°**ï¼šUI â†’ Business â†’ Data â†’ Platform
2. **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹
3. **ä¾èµ–æ³¨å…¥**ï¼šä¾¿äºæµ‹è¯•å’Œæ›¿æ¢
4. **çŠ¶æ€ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†åº”ç”¨çŠ¶æ€
5. **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

## äºŒã€æŠ€æœ¯æ ˆé€‰å‹

### 2.1 è·¨å¹³å°æ¡†æ¶

**é€‰æ‹©ï¼šFlutter 3.x**

**ç†ç”±**ï¼š
- âœ… ä¸€å¥—ä»£ç ï¼ŒåŒå¹³å°å‘å¸ƒ
- âœ… æ€§èƒ½æ¥è¿‘åŸç”Ÿï¼ˆ60 FPSï¼‰
- âœ… ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“ç”Ÿæ€
- âœ… Google å®˜æ–¹æ”¯æŒï¼Œæ›´æ–°æ´»è·ƒ
- âœ… çƒ­é‡è½½ï¼Œå¼€å‘æ•ˆç‡é«˜

**ç‰ˆæœ¬è¦æ±‚**ï¼š
- Flutter SDK: >= 3.16.0
- Dart SDK: >= 3.2.0

### 2.2 çŠ¶æ€ç®¡ç†

**é€‰æ‹©ï¼šProvider**

**ç†ç”±**ï¼š
- âœ… Flutter å®˜æ–¹æ¨è
- âœ… ç®€å•æ˜“å­¦
- âœ… æ€§èƒ½å¥½
- âœ… é€‚åˆä¸­å°å‹åº”ç”¨

**å¤‡é€‰æ–¹æ¡ˆ**ï¼š
- Riverpodï¼ˆæ›´ç°ä»£ï¼Œä½†å­¦ä¹ æ›²çº¿é™¡ï¼‰
- Blocï¼ˆé€‚åˆå¤§å‹åº”ç”¨ï¼Œä½†è¿‡äºå¤æ‚ï¼‰

### 2.3 æ‰«æåº“

**Android**ï¼š
- **ML Kit Barcode Scanning**ï¼ˆGoogle å®˜æ–¹ï¼‰
- ä¼˜ç‚¹ï¼šå…è´¹ã€å‡†ç¡®ã€æ˜“ç”¨ã€æ”¯æŒå¤šç§æ ¼å¼
- ç¼ºç‚¹ï¼šéœ€è¦ Google Play Services

**iOS**ï¼š
- **Vision Framework**ï¼ˆApple å®˜æ–¹ï¼‰
- ä¼˜ç‚¹ï¼šåŸç”Ÿæ”¯æŒã€æ€§èƒ½å¥½ã€æ— éœ€é¢å¤–ä¾èµ–
- ç¼ºç‚¹ï¼šä»… iOS 11+

**Flutter å°è£…**ï¼š
- **mobile_scanner** (æ¨è)
  - å°è£… ML Kit å’Œ Vision Framework
  - æ”¯æŒç›¸æœºé¢„è§ˆã€æ‰‹ç”µç­’ã€ç¼©æ”¾
  - æ´»è·ƒç»´æŠ¤ï¼Œæ–‡æ¡£å®Œå–„

**å¤‡é€‰**ï¼š
- `qr_code_scanner`ï¼ˆè¾ƒè€ï¼Œä¸æ¨èï¼‰
- `camera` + `google_mlkit_barcode_scanning`ï¼ˆæ›´çµæ´»ä½†å¤æ‚ï¼‰

### 2.4 QR ç ç”Ÿæˆ

**é€‰æ‹©ï¼šqr_flutter**

**ç†ç”±**ï¼š
- âœ… çº¯ Dart å®ç°ï¼Œæ— åŸç”Ÿä¾èµ–
- âœ… æ”¯æŒè‡ªå®šä¹‰é¢œè‰²ã€å°ºå¯¸ã€é”™è¯¯çº æ­£çº§åˆ«
- âœ… æ€§èƒ½å¥½ï¼Œå¯ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡
- âœ… æ´»è·ƒç»´æŠ¤

### 2.5 æ•°æ®åº“

**é€‰æ‹©ï¼šsqflite**

**ç†ç”±**ï¼š
- âœ… SQLite çš„ Flutter å°è£…
- âœ… æˆç†Ÿç¨³å®š
- âœ… æ”¯æŒäº‹åŠ¡ã€æŸ¥è¯¢ã€ç´¢å¼•
- âœ… é€‚åˆæœ¬åœ°æ•°æ®å­˜å‚¨

**å¤‡é€‰**ï¼š
- `hive`ï¼ˆNoSQLï¼Œæ›´å¿«ä½†åŠŸèƒ½å°‘ï¼‰
- `drift`ï¼ˆç±»å‹å®‰å…¨ï¼Œä½†å­¦ä¹ æ›²çº¿é™¡ï¼‰

### 2.6 å…¶ä»–ä¾èµ–

```yaml
dependencies:
  flutter:
    sdk: flutter
  
  # æ‰«æ
  mobile_scanner: ^3.5.0
  
  # QR ç”Ÿæˆ
  qr_flutter: ^4.1.0
  
  # æ•°æ®åº“
  sqflite: ^2.3.0
  path: ^1.8.0
  path_provider: ^2.1.0
  
  # çŠ¶æ€ç®¡ç†
  provider: ^6.1.0
  
  # æƒé™
  permission_handler: ^11.0.0
  
  # åˆ†äº«å’Œä¿å­˜
  share_plus: ^7.0.0
  image_gallery_saver: ^2.0.0
  
  # URL å¤„ç†
  url_launcher: ^6.2.0
  
  # å·¥å…·
  intl: ^0.18.0
  uuid: ^4.0.0
  
dev_dependencies:
  flutter_test:
    sdk: flutter
  mockito: ^5.4.0
  build_runner: ^2.4.0
```

---

## ä¸‰ã€é¡¹ç›®ç»“æ„

### 3.1 ç›®å½•ç»“æ„

```
lib/
â”œâ”€â”€ main.dart                    # åº”ç”¨å…¥å£
â”œâ”€â”€ app.dart                     # åº”ç”¨é…ç½®
â”‚
â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ scan_result.dart         # æ‰«æç»“æœæ¨¡å‹
â”‚   â”œâ”€â”€ qr_type.dart            # QR ç ç±»å‹æšä¸¾
â”‚   â””â”€â”€ history_item.dart        # å†å²è®°å½•æ¨¡å‹
â”‚
â”œâ”€â”€ providers/                   # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ scan_provider.dart       # æ‰«æçŠ¶æ€
â”‚   â”œâ”€â”€ generate_provider.dart   # ç”ŸæˆçŠ¶æ€
â”‚   â””â”€â”€ history_provider.dart    # å†å²è®°å½•çŠ¶æ€
â”‚
â”œâ”€â”€ screens/                     # é¡µé¢
â”‚   â”œâ”€â”€ scan/
â”‚   â”‚   â”œâ”€â”€ scan_screen.dart     # æ‰«æä¸»é¡µé¢
â”‚   â”‚   â””â”€â”€ scan_result_screen.dart  # æ‰«æç»“æœé¡µé¢
â”‚   â”œâ”€â”€ generate/
â”‚   â”‚   â”œâ”€â”€ generate_screen.dart # ç”Ÿæˆä¸»é¡µé¢
â”‚   â”‚   â””â”€â”€ qr_preview_screen.dart   # QR é¢„è§ˆé¡µé¢
â”‚   â””â”€â”€ history/
â”‚       â”œâ”€â”€ history_screen.dart  # å†å²è®°å½•åˆ—è¡¨
â”‚       â””â”€â”€ history_detail_screen.dart  # å†å²è¯¦æƒ…
â”‚
â”œâ”€â”€ widgets/                     # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ qr_preview.dart         # QR ç é¢„è§ˆç»„ä»¶
â”‚   â”œâ”€â”€ history_item.dart       # å†å²è®°å½•é¡¹ç»„ä»¶
â”‚   â”œâ”€â”€ scan_overlay.dart       # æ‰«ææ¡†è¦†ç›–å±‚
â”‚   â””â”€â”€ custom_button.dart      # è‡ªå®šä¹‰æŒ‰é’®
â”‚
â”œâ”€â”€ services/                    # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ scanner_service.dart     # æ‰«ææœåŠ¡
â”‚   â”œâ”€â”€ qr_generator_service.dart  # QR ç”ŸæˆæœåŠ¡
â”‚   â”œâ”€â”€ database_service.dart    # æ•°æ®åº“æœåŠ¡
â”‚   â””â”€â”€ file_service.dart       # æ–‡ä»¶æœåŠ¡
â”‚
â”œâ”€â”€ utils/                       # å·¥å…·ç±»
â”‚   â”œâ”€â”€ constants.dart          # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ helpers.dart            # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ validators.dart         # éªŒè¯å™¨
â”‚   â””â”€â”€ formatters.dart         # æ ¼å¼åŒ–å·¥å…·
â”‚
â””â”€â”€ config/                      # é…ç½®
    â”œâ”€â”€ routes.dart             # è·¯ç”±é…ç½®
    â””â”€â”€ theme.dart              # ä¸»é¢˜é…ç½®
```

### 3.2 æ–‡ä»¶å‘½åè§„èŒƒ

- **æ–‡ä»¶**ï¼šsnake_caseï¼ˆ`scan_screen.dart`ï¼‰
- **ç±»**ï¼šPascalCaseï¼ˆ`ScanScreen`ï¼‰
- **å˜é‡/å‡½æ•°**ï¼šcamelCaseï¼ˆ`scanResult`ï¼‰
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASEï¼ˆ`MAX_HISTORY_COUNT`ï¼‰

---

## å››ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 æ‰«ææœåŠ¡ (ScannerService)

```dart
class ScannerService {
  // åˆå§‹åŒ–æ‰«æå™¨
  Future<void> initialize();
  
  // å¼€å§‹æ‰«æ
  Stream<BarcodeCapture> startScanning();
  
  // åœæ­¢æ‰«æ
  Future<void> stopScanning();
  
  // ä»å›¾ç‰‡æ‰«æ
  Future<List<Barcode>> scanFromImage(String imagePath);
  
  // é‡Šæ”¾èµ„æº
  Future<void> dispose();
}
```

**å®ç°è¦ç‚¹**ï¼š
- ä½¿ç”¨ `mobile_scanner` å°è£…
- å¤„ç†æƒé™è¯·æ±‚
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- èµ„æºç®¡ç†ï¼ˆç›¸æœºé‡Šæ”¾ï¼‰

### 4.2 QR ç”ŸæˆæœåŠ¡ (QRGeneratorService)

```dart
class QRGeneratorService {
  // ç”Ÿæˆ QR ç å›¾ç‰‡
  Future<Uint8List> generateQRCode({
    required String data,
    required QRType type,
    Color? foregroundColor,
    Color? backgroundColor,
    int size = 512,
  });
  
  // éªŒè¯æ•°æ®æ ¼å¼
  bool validateData(String data, QRType type);
  
  // æ ¼å¼åŒ–æ•°æ®ï¼ˆæ ¹æ®ç±»å‹ï¼‰
  String formatData(String data, QRType type);
}
```

**å®ç°è¦ç‚¹**ï¼š
- ä½¿ç”¨ `qr_flutter` ç”Ÿæˆ
- æ•°æ®éªŒè¯ï¼ˆURLã€é‚®ç®±ã€ç”µè¯ç­‰ï¼‰
- é”™è¯¯çº æ­£çº§åˆ«è®¾ç½®
- å›¾ç‰‡æ ¼å¼è½¬æ¢

### 4.3 æ•°æ®åº“æœåŠ¡ (DatabaseService)

```dart
class DatabaseService {
  // åˆå§‹åŒ–æ•°æ®åº“
  Future<void> initialize();
  
  // æ’å…¥æ‰«æè®°å½•
  Future<int> insertScanHistory(ScanResult result);
  
  // æŸ¥è¯¢æ‰€æœ‰è®°å½•
  Future<List<HistoryItem>> getAllHistory();
  
  // æœç´¢è®°å½•
  Future<List<HistoryItem>> searchHistory(String query);
  
  // åˆ é™¤è®°å½•
  Future<void> deleteHistory(int id);
  
  // æ¸…ç©ºæ‰€æœ‰è®°å½•
  Future<void> clearAllHistory();
  
  // è·å–è®°å½•æ•°é‡
  Future<int> getHistoryCount();
}
```

**å®ç°è¦ç‚¹**ï¼š
- ä½¿ç”¨ `sqflite` æ“ä½œæ•°æ®åº“
- å¼‚æ­¥æ“ä½œï¼Œä¸é˜»å¡ UI
- äº‹åŠ¡å¤„ç†
- ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### 4.4 çŠ¶æ€ç®¡ç† (Providers)

#### ScanProvider

```dart
class ScanProvider with ChangeNotifier {
  bool _isScanning = false;
  ScanResult? _lastResult;
  String? _error;
  
  bool get isScanning => _isScanning;
  ScanResult? get lastResult => _lastResult;
  String? get error => _error;
  
  Future<void> startScan();
  Future<void> stopScan();
  void handleScanResult(BarcodeCapture capture);
  void clearError();
}
```

#### HistoryProvider

```dart
class HistoryProvider with ChangeNotifier {
  List<HistoryItem> _history = [];
  bool _isLoading = false;
  
  List<HistoryItem> get history => _history;
  bool get isLoading => _isLoading;
  
  Future<void> loadHistory();
  Future<void> addHistory(ScanResult result);
  Future<void> deleteHistory(int id);
  Future<void> clearAll();
  Future<void> search(String query);
}
```

---

## äº”ã€æ•°æ®åº“è®¾è®¡

### 5.1 è¡¨ç»“æ„

#### scan_history è¡¨

```sql
CREATE TABLE scan_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  type TEXT NOT NULL,                    -- 'url', 'text', 'wifi', 'contact', 'phone', 'sms'
  content TEXT NOT NULL,                 -- åŸå§‹å†…å®¹
  formatted_content TEXT,                -- æ ¼å¼åŒ–åçš„å†…å®¹ï¼ˆJSONï¼‰
  scan_time INTEGER NOT NULL,            -- æ—¶é—´æˆ³ï¼ˆUnix timestampï¼‰
  preview_image_path TEXT,               -- QR ç é¢„è§ˆå›¾è·¯å¾„ï¼ˆå¯é€‰ï¼‰
  created_at INTEGER DEFAULT (strftime('%s', 'now'))
);

CREATE INDEX idx_scan_time ON scan_history(scan_time DESC);
CREATE INDEX idx_type ON scan_history(type);
```

**å­—æ®µè¯´æ˜**ï¼š
- `id`: ä¸»é”®ï¼Œè‡ªå¢
- `type`: QR ç ç±»å‹
- `content`: åŸå§‹æ‰«æå†…å®¹
- `formatted_content`: JSON æ ¼å¼çš„æ ¼å¼åŒ–å†…å®¹ï¼ˆä¾¿äºæŸ¥è¯¢å’Œæ˜¾ç¤ºï¼‰
- `scan_time`: æ‰«ææ—¶é—´æˆ³
- `preview_image_path`: é¢„è§ˆå›¾è·¯å¾„ï¼ˆå¯é€‰ï¼ŒèŠ‚çœç©ºé—´ï¼‰

**ç´¢å¼•**ï¼š
- `scan_time` é™åºç´¢å¼•ï¼šå¿«é€Ÿè·å–æœ€æ–°è®°å½•
- `type` ç´¢å¼•ï¼šæŒ‰ç±»å‹ç­›é€‰

### 5.2 æ•°æ®æ¨¡å‹

```dart
class HistoryItem {
  final int id;
  final QRType type;
  final String content;
  final Map<String, dynamic>? formattedContent;
  final DateTime scanTime;
  final String? previewImagePath;
  
  HistoryItem({
    required this.id,
    required this.type,
    required this.content,
    this.formattedContent,
    required this.scanTime,
    this.previewImagePath,
  });
  
  factory HistoryItem.fromMap(Map<String, dynamic> map) {
    return HistoryItem(
      id: map['id'] as int,
      type: QRType.fromString(map['type'] as String),
      content: map['content'] as String,
      formattedContent: map['formatted_content'] != null
          ? jsonDecode(map['formatted_content'] as String)
          : null,
      scanTime: DateTime.fromMillisecondsSinceEpoch(
        (map['scan_time'] as int) * 1000,
      ),
      previewImagePath: map['preview_image_path'] as String?,
    );
  }
  
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'type': type.toString(),
      'content': content,
      'formatted_content': formattedContent != null
          ? jsonEncode(formattedContent)
          : null,
      'scan_time': scanTime.millisecondsSinceEpoch ~/ 1000,
      'preview_image_path': previewImagePath,
    };
  }
}
```

### 5.3 æ•°æ®è¿ç§»

**ç‰ˆæœ¬ç®¡ç†**ï¼š
- ä½¿ç”¨ `sqflite` çš„ç‰ˆæœ¬å·ç®¡ç†
- æ¯æ¬¡ä¿®æ”¹è¡¨ç»“æ„æ—¶é€’å¢ç‰ˆæœ¬å·
- å®ç° `onUpgrade` å¤„ç†è¿ç§»

```dart
static const int _databaseVersion = 1;

Future<void> _onUpgrade(
  Database db,
  int oldVersion,
  int newVersion,
) async {
  if (oldVersion < 2) {
    // è¿ç§»åˆ°ç‰ˆæœ¬ 2
  }
}
```

---

## å…­ã€API è®¾è®¡ï¼ˆé¢„ç•™ï¼‰

### 6.1 æœªæ¥äº‘åŒæ­¥ APIï¼ˆPhase 2ï¼‰

**åŸºç¡€ URL**ï¼š
```
https://api.scanproqr.com/v1
```

**è®¤è¯**ï¼š
- Bearer Tokenï¼ˆJWTï¼‰

**ç«¯ç‚¹**ï¼š

```
POST   /auth/register          # æ³¨å†Œ
POST   /auth/login             # ç™»å½•
POST   /auth/refresh           # åˆ·æ–° Token

GET    /history                # è·å–å†å²è®°å½•
POST   /history                # ä¸Šä¼ å†å²è®°å½•
PUT    /history/:id            # æ›´æ–°è®°å½•
DELETE /history/:id            # åˆ é™¤è®°å½•
POST   /history/sync           # åŒæ­¥ï¼ˆæ‰¹é‡ï¼‰

GET    /stats                  # è·å–ç»Ÿè®¡ä¿¡æ¯
```

**æ•°æ®æ ¼å¼**ï¼š
```json
{
  "id": "uuid",
  "type": "url",
  "content": "https://example.com",
  "formatted_content": {...},
  "scan_time": 1706544000,
  "device_id": "device-uuid",
  "created_at": 1706544000,
  "updated_at": 1706544000
}
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 æ‰«ææ€§èƒ½

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **é™ä½æ‰«æé¢‘ç‡**ï¼šé™åˆ¶å¸§ç‡åˆ° 15-20 FPSï¼ˆè¶³å¤Ÿï¼‰
2. **ROI åŒºåŸŸ**ï¼šåªæ‰«æå–æ™¯æ¡†åŒºåŸŸ
3. **å›¾ç‰‡å‹ç¼©**ï¼šä»å›¾ç‰‡æ‰«ææ—¶å…ˆå‹ç¼©
4. **ç¼“å­˜ç»“æœ**ï¼šé¿å…é‡å¤æ‰«æç›¸åŒå†…å®¹

### 7.2 åˆ—è¡¨æ€§èƒ½

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **åˆ†é¡µåŠ è½½**ï¼šæ¯æ¬¡åŠ è½½ 20-50 æ¡
2. **è™šæ‹Ÿæ»šåŠ¨**ï¼šä½¿ç”¨ `ListView.builder`
3. **å›¾ç‰‡æ‡’åŠ è½½**ï¼šé¢„è§ˆå›¾æŒ‰éœ€åŠ è½½
4. **ç¼“å­˜**ï¼šä½¿ç”¨ `CachedNetworkImage`ï¼ˆå¦‚æœæœªæ¥æœ‰ç½‘ç»œå›¾ç‰‡ï¼‰

### 7.3 å†…å­˜ä¼˜åŒ–

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **åŠæ—¶é‡Šæ”¾**ï¼šæ‰«æå®Œæˆåé‡Šæ”¾ç›¸æœºèµ„æº
2. **å›¾ç‰‡å‹ç¼©**ï¼šä¿å­˜é¢„è§ˆå›¾æ—¶å‹ç¼©
3. **é™åˆ¶å†å²è®°å½•**ï¼šæœ€å¤šä¿å­˜ 1000 æ¡ï¼ˆMVPï¼‰
4. **å®šæœŸæ¸…ç†**ï¼šåˆ é™¤æ—§è®°å½•

### 7.4 å¯åŠ¨ä¼˜åŒ–

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šéå…³é”®æœåŠ¡å»¶è¿ŸåŠ è½½
2. **é¢„åŠ è½½**ï¼šæå‰åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
3. **å‡å°‘å¯åŠ¨ä»»åŠ¡**ï¼šå¯åŠ¨æ—¶åªåšå¿…è¦æ“ä½œ

---

## å…«ã€å®‰å…¨è€ƒè™‘

### 8.1 æ•°æ®å®‰å…¨

**æœ¬åœ°æ•°æ®**ï¼š
- SQLite æ•°æ®åº“ä¸åŠ å¯†ï¼ˆMVP é˜¶æ®µï¼‰
- Phase 2 å¯è€ƒè™‘åŠ å¯†æ•æ„Ÿæ•°æ®

**æ–‡ä»¶å­˜å‚¨**ï¼š
- é¢„è§ˆå›¾å­˜å‚¨åœ¨åº”ç”¨ç§æœ‰ç›®å½•
- ä¸æš´éœ²ç»™å…¶ä»–åº”ç”¨

### 8.2 æƒé™å®‰å…¨

**æœ€å°æƒé™åŸåˆ™**ï¼š
- åªç”³è¯·å¿…è¦æƒé™
- æƒé™è¢«æ‹’ç»æ—¶ç»™å‡ºå‹å¥½æç¤º
- ä¸å¼ºåˆ¶è¦æ±‚éå¿…è¦æƒé™

### 8.3 ç½‘ç»œå®‰å…¨ï¼ˆPhase 2ï¼‰

**HTTPS**ï¼š
- æ‰€æœ‰ API è¯·æ±‚ä½¿ç”¨ HTTPS
- è¯ä¹¦é”å®šï¼ˆCertificate Pinningï¼‰

**æ•°æ®åŠ å¯†**ï¼š
- æ•æ„Ÿæ•°æ®åŠ å¯†ä¼ è¾“
- ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆå¦‚æœæ”¯æŒï¼‰

---

## ä¹ã€æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•èŒƒå›´**ï¼š
- ä¸šåŠ¡é€»è¾‘ï¼ˆServicesï¼‰
- æ•°æ®æ¨¡å‹ï¼ˆModelsï¼‰
- å·¥å…·å‡½æ•°ï¼ˆUtilsï¼‰

**æµ‹è¯•æ¡†æ¶**ï¼š
- `flutter_test`
- `mockito`ï¼ˆMock ä¾èµ–ï¼‰

**ç¤ºä¾‹**ï¼š
```dart
test('QRGeneratorService should generate valid QR code', () {
  final service = QRGeneratorService();
  final result = await service.generateQRCode(
    data: 'https://example.com',
    type: QRType.url,
  );
  expect(result, isNotNull);
  expect(result.length, greaterThan(0));
});
```

### 9.2 é›†æˆæµ‹è¯•

**æµ‹è¯•èŒƒå›´**ï¼š
- æ‰«ææµç¨‹
- ç”Ÿæˆæµç¨‹
- å†å²è®°å½• CRUD

**æµ‹è¯•æ¡†æ¶**ï¼š
- `integration_test`

### 9.3 çœŸæœºæµ‹è¯•

**æµ‹è¯•è®¾å¤‡**ï¼š
- Androidï¼šè‡³å°‘ 3 æ¬¾ä¸åŒå“ç‰Œ/ç‰ˆæœ¬
- iOSï¼šè‡³å°‘ 2 æ¬¾ä¸åŒç‰ˆæœ¬

**æµ‹è¯•åœºæ™¯**ï¼š
- ä¸åŒå…‰ç…§æ¡ä»¶
- ä¸åŒè§’åº¦æ‰«æ
- ä¸åŒ QR ç ç±»å‹
- è¾¹ç•Œæƒ…å†µï¼ˆæ¨¡ç³Šã€å°ç ç­‰ï¼‰

---

## åã€éƒ¨ç½²æ–¹æ¡ˆ

### 10.1 Android å‘å¸ƒ

**æ„å»ºé…ç½®**ï¼š
```gradle
android {
    compileSdkVersion 34
    
    defaultConfig {
        applicationId "com.scanproqr.app"
        minSdkVersion 21
        targetSdkVersion 34
        versionCode 1
        versionName "1.0.0"
    }
    
    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true
            shrinkResources true
        }
    }
}
```

**å‘å¸ƒæµç¨‹**ï¼š
1. ç”Ÿæˆç­¾åå¯†é’¥
2. é…ç½®ç­¾å
3. æ„å»º Release APK/AAB
4. æäº¤ Google Play Console
5. å†…éƒ¨æµ‹è¯• â†’ Alpha â†’ Beta â†’ æ­£å¼å‘å¸ƒ

### 10.2 iOS å‘å¸ƒ

**æ„å»ºé…ç½®**ï¼š
- Xcode 14+
- iOS 11+ æ”¯æŒ
- é…ç½® App IDã€è¯ä¹¦ã€æè¿°æ–‡ä»¶

**å‘å¸ƒæµç¨‹**ï¼š
1. é…ç½® App Store Connect
2. Archive æ„å»º
3. ä¸Šä¼ åˆ° App Store Connect
4. æäº¤å®¡æ ¸
5. TestFlight æµ‹è¯• â†’ æ­£å¼å‘å¸ƒ

### 10.3 CI/CDï¼ˆå¯é€‰ï¼‰

**å·¥å…·é€‰æ‹©**ï¼š
- GitHub Actionsï¼ˆå…è´¹ï¼‰
- Codemagicï¼ˆFlutter ä¸“ç”¨ï¼‰
- Fastlaneï¼ˆè‡ªåŠ¨åŒ–å‘å¸ƒï¼‰

**æµç¨‹**ï¼š
1. ä»£ç æäº¤ â†’ è§¦å‘æ„å»º
2. è¿è¡Œæµ‹è¯•
3. æ„å»º Release ç‰ˆæœ¬
4. è‡ªåŠ¨ä¸Šä¼ åˆ°åº”ç”¨å•†åº—ï¼ˆå¯é€‰ï¼‰

---

## åä¸€ã€æŠ€æœ¯å€ºåŠ¡ç®¡ç†

### 11.1 MVP é˜¶æ®µæŠ€æœ¯å€ºåŠ¡

**å·²çŸ¥é—®é¢˜**ï¼š
1. æ•°æ®åº“ä¸åŠ å¯†ï¼ˆPhase 2 è§£å†³ï¼‰
2. æ— é”™è¯¯ä¸ŠæŠ¥ï¼ˆPhase 2 æ·»åŠ  Sentryï¼‰
3. æ— æ€§èƒ½ç›‘æ§ï¼ˆPhase 2 æ·»åŠ  Firebaseï¼‰
4. ç¡¬ç¼–ç é…ç½®ï¼ˆPhase 2 æ”¹ä¸ºé…ç½®æ–‡ä»¶ï¼‰

### 11.2 é‡æ„è®¡åˆ’

**Phase 2 é‡æ„**ï¼š
- å¼•å…¥ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚ `get_it`ï¼‰
- ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- æ·»åŠ æ—¥å¿—ç³»ç»Ÿ
- ä»£ç è§„èŒƒåŒ–ï¼ˆlintï¼‰

---

## åäºŒã€æ€»ç»“

### æŠ€æœ¯é€‰å‹æ€»ç»“

| æ¨¡å— | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|---------|------|
| æ¡†æ¶ | Flutter | è·¨å¹³å°ï¼Œæ•ˆç‡é«˜ |
| çŠ¶æ€ç®¡ç† | Provider | ç®€å•æ˜“ç”¨ |
| æ‰«æ | mobile_scanner | å°è£…å®Œå–„ |
| ç”Ÿæˆ | qr_flutter | çº¯ Dartï¼Œæ€§èƒ½å¥½ |
| æ•°æ®åº“ | sqflite | æˆç†Ÿç¨³å®š |

### å…³é”®æˆåŠŸå› ç´ 

1. âœ… **æŠ€æœ¯é€‰å‹æ­£ç¡®**ï¼šä½¿ç”¨æˆç†Ÿæ–¹æ¡ˆï¼Œé™ä½é£é™©
2. âœ… **æ¶æ„æ¸…æ™°**ï¼šåˆ†å±‚æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤
3. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå…³æ³¨å…³é”®è·¯å¾„æ€§èƒ½
4. âœ… **æµ‹è¯•å……åˆ†**ï¼šä¿è¯è´¨é‡

---

**ä¸‹ä¸€æ­¥**ï¼š
1. âœ… ç¡®è®¤æŠ€æœ¯é€‰å‹
2. â­ï¸ æ­å»ºå¼€å‘ç¯å¢ƒ
3. â­ï¸ åˆ›å»ºé¡¹ç›®éª¨æ¶
4. â­ï¸ å¼€å§‹æ ¸å¿ƒåŠŸèƒ½å¼€å‘
