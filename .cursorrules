# ScanPro QR - Cursor IDE Rules
## Flutter/Dart é¡¹ç›®å¼€å‘è§„èŒƒ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šScanPro QR  
**æŠ€æœ¯æ ˆ**ï¼šFlutter 3.x + Dart 3.x  
**çŠ¶æ€ç®¡ç†**ï¼šProvider  
**ç›®æ ‡å¹³å°**ï¼šAndroid + iOS  
**å¼€å‘é˜¶æ®µ**ï¼šMVP (4-6å‘¨)

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **ç®€æ´ä¼˜å…ˆ**ï¼šä»£ç è¦æ¸…æ™°ã€æ˜“è¯»ã€æ˜“ç»´æŠ¤
2. **æ€§èƒ½ä¼˜å…ˆ**ï¼šå…³æ³¨å…³é”®è·¯å¾„æ€§èƒ½ï¼ˆæ‰«æé€Ÿåº¦ < 0.5ç§’ï¼‰
3. **ç”¨æˆ·ä¼˜å…ˆ**ï¼šæ‰€æœ‰åŠŸèƒ½ä»¥ç”¨æˆ·ä½“éªŒä¸ºä¸­å¿ƒ
4. **æµ‹è¯•é©±åŠ¨**ï¼šå…³é”®åŠŸèƒ½å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–

---

## ğŸ“ é¡¹ç›®ç»“æ„è§„èŒƒ

### ç›®å½•ç»“æ„
```
lib/
â”œâ”€â”€ main.dart                    # åº”ç”¨å…¥å£
â”œâ”€â”€ app.dart                     # åº”ç”¨é…ç½®
â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹
â”œâ”€â”€ providers/                   # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ screens/                     # é¡µé¢
â”œâ”€â”€ widgets/                     # å¯å¤ç”¨ç»„ä»¶
â”œâ”€â”€ services/                    # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ utils/                       # å·¥å…·ç±»
â””â”€â”€ config/                      # é…ç½®
```

### æ–‡ä»¶å‘½å
- **æ–‡ä»¶**ï¼šsnake_caseï¼ˆ`scan_screen.dart`ï¼‰
- **ç±»**ï¼šPascalCaseï¼ˆ`ScanScreen`ï¼‰
- **å˜é‡/å‡½æ•°**ï¼šcamelCaseï¼ˆ`scanResult`ï¼‰
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASEï¼ˆ`MAX_HISTORY_COUNT`ï¼‰

---

## ğŸ’» Flutter/Dart ä»£ç è§„èŒƒ

### éµå¾ª Effective Dart æŒ‡å—
- ä½¿ç”¨ `dart format` æ ¼å¼åŒ–ä»£ç 
- éµå¾ª Dart å®˜æ–¹é£æ ¼æŒ‡å—
- ä½¿ç”¨ `dart analyze` æ£€æŸ¥ä»£ç è´¨é‡

### ä»£ç é£æ ¼
```dart
// âœ… å¥½çš„åšæ³•
class ScanService {
  Future<void> startScan() async {
    // å®ç°
  }
}

// âŒ é¿å…
class scanService {  // ç±»ååº”è¯¥æ˜¯ PascalCase
  Future<void> StartScan() async {  // æ–¹æ³•ååº”è¯¥æ˜¯ camelCase
    // å®ç°
  }
}
```

### å‘½åè§„èŒƒ
- **ç±»å**ï¼šPascalCaseï¼Œæè¿°æ€§å¼ºï¼ˆ`QRGeneratorService`ï¼‰
- **æ–‡ä»¶å**ï¼šsnake_caseï¼Œä¸ç±»åå¯¹åº”ï¼ˆ`qr_generator_service.dart`ï¼‰
- **å˜é‡å**ï¼šcamelCaseï¼Œæ¸…æ™°è¡¨è¾¾æ„å›¾ï¼ˆ`scanResult`ï¼‰
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASEï¼ˆ`MAX_HISTORY_ITEMS`ï¼‰
- **ç§æœ‰æˆå‘˜**ï¼šä¸‹åˆ’çº¿å‰ç¼€ï¼ˆ`_privateField`ï¼‰

### å¯¼å…¥é¡ºåº
```dart
// 1. Dart SDK
import 'dart:async';
import 'dart:io';

// 2. Flutter æ¡†æ¶
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';

// 3. ç¬¬ä¸‰æ–¹åŒ…
import 'package:provider/provider.dart';
import 'package:mobile_scanner/mobile_scanner.dart';

// 4. é¡¹ç›®å†…éƒ¨ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
import '../models/scan_result.dart';
import '../services/scanner_service.dart';
```

---

## ğŸ—ï¸ æ¶æ„è§„èŒƒ

### åˆ†å±‚æ¶æ„
1. **UI Layer (screens/widgets)**ï¼šåªè´Ÿè´£å±•ç¤ºå’Œç”¨æˆ·äº¤äº’
2. **Business Layer (providers/services)**ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†
3. **Data Layer (services/database)**ï¼šæ•°æ®è®¿é—®å’Œå­˜å‚¨

### çŠ¶æ€ç®¡ç†ï¼ˆProviderï¼‰
```dart
// âœ… å¥½çš„åšæ³•ï¼šProvider åªç®¡ç†çŠ¶æ€ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
class ScanProvider with ChangeNotifier {
  bool _isScanning = false;
  ScanResult? _lastResult;
  
  bool get isScanning => _isScanning;
  ScanResult? get lastResult => _lastResult;
  
  // ä¸šåŠ¡é€»è¾‘åº”è¯¥åœ¨ Service ä¸­
  Future<void> startScan() async {
    _isScanning = true;
    notifyListeners();
    
    final service = ScannerService();
    final result = await service.scan();
    
    _lastResult = result;
    _isScanning = false;
    notifyListeners();
  }
}
```

### æœåŠ¡å±‚è®¾è®¡
```dart
// âœ… å¥½çš„åšæ³•ï¼šService æ˜¯çº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ— çŠ¶æ€
class ScannerService {
  Future<ScanResult> scan() async {
    // æ‰«æé€»è¾‘
  }
  
  Future<void> dispose() async {
    // æ¸…ç†èµ„æº
  }
}
```

---

## ğŸ§© Widget è®¾è®¡è§„èŒƒ

### Widget æ‹†åˆ†åŸåˆ™
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ª Widget åªåšä¸€ä»¶äº‹
- **å¯å¤ç”¨æ€§**ï¼šæå–å…¬å…±ç»„ä»¶åˆ° `widgets/`
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ `const` æ„é€ å‡½æ•°

```dart
// âœ… å¥½çš„åšæ³•ï¼šå°çš„ã€å¯å¤ç”¨çš„ Widget
class QRPreview extends StatelessWidget {
  final String data;
  final int size;
  
  const QRPreview({
    Key? key,
    required this.data,
    this.size = 256,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return QrImageView(
      data: data,
      size: size,
    );
  }
}
```

### é¡µé¢ Widget
- é¡µé¢æ”¾åœ¨ `screens/` ç›®å½•
- ä½¿ç”¨ `StatelessWidget` æˆ– `Consumer`ï¼ˆå¦‚æœåªéœ€è¦è¯»å–çŠ¶æ€ï¼‰
- å¤æ‚é¡µé¢å¯ä»¥æ‹†åˆ†æˆå¤šä¸ª Widget

---

## ğŸ“Š æ•°æ®æ¨¡å‹è§„èŒƒ

### Model è®¾è®¡
```dart
// âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„ Modelï¼Œæ”¯æŒåºåˆ—åŒ–
class ScanResult {
  final int id;
  final QRType type;
  final String content;
  final DateTime scanTime;
  
  ScanResult({
    required this.id,
    required this.type,
    required this.content,
    required this.scanTime,
  });
  
  // æ”¯æŒ JSON åºåˆ—åŒ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'type': type.toString(),
      'content': content,
      'scan_time': scanTime.millisecondsSinceEpoch,
    };
  }
  
  factory ScanResult.fromMap(Map<String, dynamic> map) {
    return ScanResult(
      id: map['id'] as int,
      type: QRType.fromString(map['type'] as String),
      content: map['content'] as String,
      scanTime: DateTime.fromMillisecondsSinceEpoch(map['scan_time'] as int),
    );
  }
}
```

---

## ğŸ”§ é”™è¯¯å¤„ç†è§„èŒƒ

### ç»Ÿä¸€é”™è¯¯å¤„ç†
```dart
// âœ… å¥½çš„åšæ³•ï¼šæ˜ç¡®çš„é”™è¯¯ç±»å‹
class ScanException implements Exception {
  final String message;
  final String? code;
  
  ScanException(this.message, {this.code});
  
  @override
  String toString() => 'ScanException: $message';
}

// ä½¿ç”¨
try {
  await scannerService.scan();
} on ScanException catch (e) {
  // å¤„ç†æ‰«æé”™è¯¯
  showError(e.message);
} catch (e) {
  // å¤„ç†æœªçŸ¥é”™è¯¯
  showError('æœªçŸ¥é”™è¯¯ï¼š$e');
}
```

### ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- ä¸è¦ç›´æ¥æ˜¾ç¤ºæŠ€æœ¯é”™è¯¯ä¿¡æ¯
- æä¾›è§£å†³å»ºè®®
- è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼ˆå¼€å‘é˜¶æ®µï¼‰

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### æµ‹è¯•æ–‡ä»¶ä½ç½®
- å•å…ƒæµ‹è¯•ï¼š`test/unit/`
- é›†æˆæµ‹è¯•ï¼š`test/integration/`
- Widget æµ‹è¯•ï¼š`test/widget/`

### æµ‹è¯•å‘½å
```dart
// âœ… å¥½çš„åšæ³•ï¼šæè¿°æ€§æµ‹è¯•åç§°
test('ScannerService should return result when scan succeeds', () {
  // æµ‹è¯•ä»£ç 
});

test('ScannerService should throw exception when camera fails', () {
  // æµ‹è¯•ä»£ç 
});
```

### æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- **æ ¸å¿ƒæœåŠ¡**ï¼š> 80%
- **å…³é”®ä¸šåŠ¡é€»è¾‘**ï¼š> 70%
- **UI ç»„ä»¶**ï¼š> 50%ï¼ˆMVP é˜¶æ®µå¯é™ä½ï¼‰

---

## ğŸ“ æ³¨é‡Šå’Œæ–‡æ¡£è§„èŒƒ

### æ–‡æ¡£æ³¨é‡Š
```dart
/// æ‰«ææœåŠ¡ç±»
/// 
/// è´Ÿè´£å¤„ç† QR ç å’Œæ¡ç çš„æ‰«æåŠŸèƒ½
/// ä½¿ç”¨ ML Kit (Android) å’Œ Vision Framework (iOS)
class ScannerService {
  /// å¼€å§‹æ‰«æ
  /// 
  /// è¿”å›æ‰«æç»“æœçš„ Stream
  /// 
  /// Throws [ScanException] å¦‚æœæ‰«æå¤±è´¥
  Stream<BarcodeCapture> startScanning() {
    // å®ç°
  }
}
```

### ä»£ç æ³¨é‡Š
- **å¤æ‚é€»è¾‘**ï¼šå¿…é¡»æ³¨é‡Š
- **ä¸šåŠ¡è§„åˆ™**ï¼šå¿…é¡»æ³¨é‡Š
- **TODO/FIXME**ï¼šæ ‡è®°å¾…åŠäº‹é¡¹

```dart
// TODO: Phase 2 - æ·»åŠ ä½å…‰å¢å¼ºåŠŸèƒ½
// FIXME: æŸäº›è®¾å¤‡ä¸Šæ‰«æé€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦ä¼˜åŒ–
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### å…³é”®æ€§èƒ½æŒ‡æ ‡
- **åº”ç”¨å¯åŠ¨**ï¼š< 2ç§’
- **æ‰«æé€Ÿåº¦**ï¼š< 0.5ç§’
- **é¡µé¢åˆ‡æ¢**ï¼šæµç•…ï¼Œ60 FPS
- **å†…å­˜å ç”¨**ï¼š< 150MB

### ä¼˜åŒ–å®è·µ
```dart
// âœ… ä½¿ç”¨ const æ„é€ å‡½æ•°
const QRPreview(data: 'test');

// âœ… é¿å…ä¸å¿…è¦çš„ rebuild
class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Consumer<MyProvider>(
      builder: (context, provider, child) {
        // åªé‡å»ºéœ€è¦çš„éƒ¨åˆ†
        return Column(
          children: [
            child!,  // ä½¿ç”¨ child é¿å…é‡å»º
            Text(provider.data),
          ],
        );
      },
      child: const ExpensiveWidget(),  // ä¸ä¼šé‡å»º
    );
  }
}

// âœ… åŠæ—¶é‡Šæ”¾èµ„æº
@override
void dispose() {
  _controller.dispose();
  _subscription.cancel();
  super.dispose();
}
```

---

## ğŸ”’ å®‰å…¨è§„èŒƒ

### æ•°æ®å®‰å…¨
- æ•æ„Ÿæ•°æ®ä¸å­˜å‚¨åœ¨æ—¥å¿—ä¸­
- ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨åº”ç”¨ç§æœ‰ç›®å½•
- Phase 2 æ·»åŠ æ•°æ®åŠ å¯†

### æƒé™å¤„ç†
```dart
// âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„æƒé™è¯·æ±‚å’Œé”™è¯¯å¤„ç†
Future<bool> requestCameraPermission() async {
  final status = await Permission.camera.request();
  
  if (status.isDenied) {
    // æ˜¾ç¤ºè¯´æ˜å¯¹è¯æ¡†
    showPermissionDialog();
    return false;
  }
  
  if (status.isPermanentlyDenied) {
    // å¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®
    openAppSettings();
    return false;
  }
  
  return status.isGranted;
}
```

---

## ğŸ“¦ ä¾èµ–ç®¡ç†è§„èŒƒ

### pubspec.yaml
- **ç‰ˆæœ¬é”å®š**ï¼šä½¿ç”¨å…·ä½“ç‰ˆæœ¬å·ï¼ˆ`^3.5.0`ï¼‰
- **å®šæœŸæ›´æ–°**ï¼šæ¯å‘¨æ£€æŸ¥ä¾èµ–æ›´æ–°
- **æœ€å°ä¾èµ–**ï¼šåªæ·»åŠ å¿…è¦çš„åŒ…

### ä¾èµ–åˆ†ç±»
```yaml
dependencies:
  # æ ¸å¿ƒä¾èµ–
  flutter:
    sdk: flutter
  
  # åŠŸèƒ½ä¾èµ–
  mobile_scanner: ^3.5.0
  qr_flutter: ^4.1.0
  
dev_dependencies:
  # å¼€å‘å·¥å…·
  flutter_test:
    sdk: flutter
  mockito: ^5.4.0
```

---

## ğŸ› Bug å’Œ Issue å¤„ç†

### Bug æŠ¥å‘Šæ ¼å¼
```markdown
**é—®é¢˜æè¿°**ï¼š
ç®€è¦æè¿°é—®é¢˜

**å¤ç°æ­¥éª¤**ï¼š
1. æ­¥éª¤ 1
2. æ­¥éª¤ 2

**é¢„æœŸè¡Œä¸º**ï¼š
åº”è¯¥å‘ç”Ÿä»€ä¹ˆ

**å®é™…è¡Œä¸º**ï¼š
å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ

**ç¯å¢ƒä¿¡æ¯**ï¼š
- è®¾å¤‡ï¼šiPhone 14 Pro
- ç³»ç»Ÿï¼šiOS 17.0
- åº”ç”¨ç‰ˆæœ¬ï¼š1.0.0
```

### ä»£ç å®¡æŸ¥è¦ç‚¹
- âœ… ä»£ç é£æ ¼ä¸€è‡´
- âœ… æ— æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æœ‰å¿…è¦çš„æµ‹è¯•
- âœ… æ— å®‰å…¨æ¼æ´

---

## ğŸ“š Git æäº¤è§„èŒƒ

### æäº¤ä¿¡æ¯æ ¼å¼
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type ç±»å‹
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ Bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·å˜æ›´

### ç¤ºä¾‹
```
feat(scan): æ·»åŠ æ‰¹é‡æ‰«æåŠŸèƒ½

- æ”¯æŒè¿ç»­æ‰«æå¤šä¸ª QR ç 
- æ·»åŠ è¿›åº¦æ˜¾ç¤º
- æ·»åŠ æš‚åœ/ç»§ç»­åŠŸèƒ½

Closes #123
```

---

## ğŸ¯ MVP é˜¶æ®µç‰¹æ®Šè§„åˆ™

### åŠŸèƒ½ä¼˜å…ˆçº§
1. **P0ï¼ˆå¿…é¡»ï¼‰**ï¼šæ ¸å¿ƒæ‰«æã€åŸºç¡€ç”Ÿæˆã€å†å²è®°å½•
2. **P1ï¼ˆé‡è¦ï¼‰**ï¼šUI/UX ä¼˜åŒ–ã€é”™è¯¯å¤„ç†
3. **P2ï¼ˆå¯é€‰ï¼‰**ï¼šé«˜çº§åŠŸèƒ½ï¼ˆPhase 2ï¼‰

### ä»£ç è´¨é‡ vs é€Ÿåº¦
- **MVP é˜¶æ®µ**ï¼šä¼˜å…ˆé€Ÿåº¦ï¼Œä½†ä»£ç è¦å¯ç»´æŠ¤
- **Phase 2+**ï¼šæé«˜ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†
- è®°å½•æ‰€æœ‰æŠ€æœ¯å€ºåŠ¡ï¼ˆTODO æ³¨é‡Šï¼‰
- Phase 2 ç»Ÿä¸€å¤„ç†
- ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½çš„æŠ€æœ¯å€ºåŠ¡å¯ä»¥å»¶å

---

## ğŸ”„ æŒç»­æ”¹è¿›

### ä»£ç å®¡æŸ¥
- æ‰€æœ‰ä»£ç å¿…é¡»ç»è¿‡å®¡æŸ¥
- å…³æ³¨ä»£ç è´¨é‡å’Œä¸€è‡´æ€§
- åˆ†äº«æœ€ä½³å®è·µ

### å®šæœŸé‡æ„
- æ¯å‘¨å›é¡¾ä»£ç 
- è¯†åˆ«é‡æ„æœºä¼š
- é€æ­¥æ”¹è¿›æ¶æ„

---

## ğŸ“– å‚è€ƒèµ„æº

- [Effective Dart](https://dart.dev/guides/language/effective-dart)
- [Flutter å®˜æ–¹æ–‡æ¡£](https://flutter.dev/docs)
- [Provider æ–‡æ¡£](https://pub.dev/packages/provider)
- [é¡¹ç›®æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ](./æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ.md)

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š
- [ ] ä»£ç æ ¼å¼åŒ–ï¼ˆ`dart format .`ï¼‰
- [ ] ä»£ç åˆ†æé€šè¿‡ï¼ˆ`dart analyze`ï¼‰
- [ ] æµ‹è¯•é€šè¿‡ï¼ˆ`flutter test`ï¼‰
- [ ] æ— æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ³¨é‡Šæ¸…æ™°
- [ ] éµå¾ªå‘½åè§„èŒƒ
- [ ] éµå¾ªé¡¹ç›®ç»“æ„

---

**æœ€åæ›´æ–°**ï¼š2026å¹´1æœˆ29æ—¥  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ
