# 批量扫码功能优化方案

**问题**：当前设计跳转到新页面，用户体验不流畅  
**优化**：改为在当前扫描页面切换模式

---

## 🎯 优化后的设计

### 方案：扫描页面模式切换

```
普通扫描模式                批量扫描模式
+------------------+        +------------------+
| [<] 扫描 [批量]  |        | [<] 扫描 [普通]  |
|                  |        | 已扫: 5  去重☑   |
|   相机预览       |        +------------------+
|                  |        |   相机预览       |
|   扫描框         |        |   扫描框         |
|                  |        +------------------+
|   提示文字       |        | 最近扫描:        |
+------------------+        | 1. https://...   |
                            | 2. 13800138000   |
                            +------------------+
                            | [清空] [导出]    |
                            +------------------+
```

### 改进点

1. **不跳页面** - 就在当前页面切换模式
2. **快速切换** - 右上角按钮切换模式
3. **状态保持** - 相机不需要重新初始化
4. **体验流畅** - 无页面跳转动画

---

## 🔧 实现方案

### 修改 ScanScreen

#### 1. 添加批量模式状态
```dart
class _ScanScreenState extends State<ScanScreen> {
  bool _isBatchMode = false;  // 批量模式开关
  
  void _toggleBatchMode() {
    setState(() {
      _isBatchMode = !_isBatchMode;
      if (_isBatchMode) {
        // 启动批量扫描
        context.read<BatchScanProvider>().startBatchScan();
      } else {
        // 停止批量扫描
        _showBatchResultDialog();
      }
    });
  }
}
```

#### 2. 根据模式显示不同 UI
```dart
@override
Widget build(BuildContext context) {
  return Scaffold(
    appBar: AppBar(
      title: Text(_isBatchMode ? '批量扫描' : '扫描'),
      actions: [
        // 模式切换按钮
        TextButton(
          onPressed: _toggleBatchMode,
          child: Text(_isBatchMode ? '普通模式' : '批量模式'),
        ),
        // 手电筒按钮
        ...
      ],
    ),
    body: Column(
      children: [
        // 批量模式时显示统计栏
        if (_isBatchMode) _buildBatchStats(),
        
        // 相机预览（始终显示）
        Expanded(child: _buildCameraView()),
        
        // 批量模式时显示结果列表
        if (_isBatchMode) _buildBatchResults(),
        
        // 批量模式时显示操作按钮
        if (_isBatchMode) _buildBatchActions(),
      ],
    ),
  );
}
```

---

## ✅ 优势

1. **无缝切换** - 不跳页面，体验流畅
2. **相机复用** - 不需要重新初始化
3. **操作简单** - 一键切换模式
4. **节省资源** - 减少页面实例

---

## 🚀 立即实现？

我可以马上修改代码实现这个优化方案。是否立即开始？
